# LilsMusic
`Simple, Beautiful Music App` <br>
`UIKit + MVVM-C + RxSwift + MusicKit + Swift Concurrency`
<br>

## ğŸ”— Links
### [ğŸ“±Â AppStore](https://ì¶”ê°€í•˜ê¸°)
### [ğŸ§‘ğŸ»â€ğŸ’»Â Blog íšŒê³ ](https://thekoon0456.tistory.com/127)
<br>

## ğŸ“Œ ì£¼ìš” ê¸°ëŠ¥
- ìµœì‹  ì¸ê¸° ìŒì•…ê³¼ ê°œì¸í™”ëœ ì¶”ì²œ ìŒì•… ì œê³µ
- ê³¡ì— ë”°ë¼ ë°°ê²½ìƒ‰ì´ ë³€ê²½ë˜ëŠ” ì˜ˆìœ ìŒì•… í”Œë ˆì´ì–´
- ìµœì‹  ë®¤ì§ë¹„ë””ì˜¤ë¥¼ ë‘˜ëŸ¬ë³´ë©° ì¢‹ì•„í•˜ëŠ” ë…¸ë˜ë¥¼ ë°”ë¡œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ì— ì €ì¥
- í¸ë¦¬í•œ í”Œë¡œíŒ… ë¯¸ë‹ˆ ë®¤ì§ í”Œë ˆì´ì–´ ì‚¬ìš©
- ë‹¤ì–‘í•œ ì• ë‹ˆë©”ì´ì…˜ê³¼ í–…í‹± ë°˜ì‘
<br>

## ğŸ“±ì‹œì—° ì˜ìƒ
|<img src="https://github.com/thekoon0456/WeatherI_Refactor/assets/106993057/e2310b70-0b10-4c95-b161-731807d37950"></img>|<img src="https://github.com/thekoon0456/WeatherI_Refactor/assets/106993057/87b36b00-853f-4ee3-843d-70c24fe81649"></img>|<img src="https://github.com/thekoon0456/WeatherI_Refactor/assets/106993057/a0107164-28f7-416d-863a-2241aa12e7c3"></img>|<img src="https://github.com/thekoon0456/WeatherI_Refactor/assets/106993057/41fc960e-83c0-4d95-88eb-27f4923ecfa2"></img>|
|:-:|:-:|:-:|:-:|
|`ìŒì•… í”Œë ˆì´ì–´`|`ë®¤ì§ë¹„ë””ì˜¤`|`ì¶”ì²œ ìŒì•…`|`ë¼ì´ë¸ŒëŸ¬ë¦¬`|
<br>

## ğŸ“ í•µì‹¬ í‚¤ì›Œë“œ
![iOS](https://img.shields.io/badge/iOS-000000?style=for-the-badge&logo=ios&logoColor=white)
![UIKit](https://img.shields.io/badge/UIkit-2396F3?style=for-the-badge&logo=UIKit&logoColor=white)
![RxSwift](https://img.shields.io/badge/RxSwift-fa4db3?style=for-the-badge&logo=ReactiveX&logoColor=white)
![MusicKit](https://img.shields.io/badge/MusicKit-FA243C?style=for-the-badge&logo=MusicKit&logoColor=white)
![AVFoundation](https://img.shields.io/badge/AVFoundation-FA243C?style=for-the-badge&logo=AVFoundation&logoColor=white)
![AVKit](https://img.shields.io/badge/AVKit-FA243C?style=for-the-badge&logo=AVKit&logoColor=white)<br>
![SwiftConcurrency](https://img.shields.io/badge/SwiftConcurrency-F54A2A?style=for-the-badge&logo=swift&logoColor=white)
![ModernCollectionView](https://img.shields.io/badge/ModernCollectionView-F54A2A?style=for-the-badge&logo=swift&logoColor=white)<br>
![Realm](https://img.shields.io/badge/realm-39477F?style=for-the-badge&logo=Realm&logoColor=white)
![SnapKit](https://img.shields.io/badge/SnapKit-4285F4?style=for-the-badge&logo=SnapKit&logoColor=white)
<br>

## ğŸ’¡ ê¸°ìˆ  ì†Œê°œ

### MVVM
- ë·°ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë¡œì§ì„ ë¶„ë¦¬í•˜ê³ , Input, Output íŒ¨í„´ì„ í™œìš©í•´ ë°ì´í„°ì˜ íë¦„ì„ ì¼ê´€ì„±ìˆê²Œ êµ¬í˜„
- ViewModel Protocolì„ í™œìš©í•´ êµ¬ì¡°ì ìœ¼ë¡œ ì¼ê´€ëœ ë·°ëª¨ë¸ êµ¬ì„± 
<br>

### Coordinator íŒ¨í„´
- ì‚¬ìš©ì ì¸ì¦, ìŒì•…í”Œë ˆì´ì–´ ì¬ìƒ ë“± í™”ë©´ì „í™˜ì½”ë“œê°€ ë¹„ëŒ€í•´ì ¸ì„œ ë·°ì»¨íŠ¸ë¡¤ëŸ¬ì™€ í™”ë©´ì „í™˜ì˜ ì—­í•  ë¶„ë¦¬
- Coordinator ìƒì„± -> ViewModel ìƒì„± -> ViewController ìƒì„±í•˜ëŠ” íŒ¨í„´ìœ¼ë¡œ ì˜ì¡´ì„± ì£¼ì…
- viewControllerì—ì„œ í™”ë©´ì „í™˜ input -> ViewModelì—ì„œ Coordinatorë¡œ í™”ë©´ì „í™˜
<br>

### RxSwift
- ì•± ë‚´ì˜ ë¹„ë™ê¸° ì‹œí€€ìŠ¤ êµ¬í˜„
- ìœ ì €ì˜ tapì„ ControlEvent<Void>íƒ€ì…ìœ¼ë¡œ Input, Outputì˜ UIë°”ì¸ë”©ì€ Driverë¥¼ í™œìš©í–ˆìŠµë‹ˆë‹¤.
- 
<br>

### MusicKit
- 
<br>

### AVFoundation, AVKit
- AVQueuePlayerì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ë§Œ ìƒì„±í•˜ê³  ì¬ìƒí•  Itemì„ ë¯¸ë¦¬ ë°°ì—´ë¡œ ë„£ì–´ë†”ì„œ ì‚¬ìš©í–ˆì§€ë§Œ í™”ë©´ ì´ë™ì‹œì— ë”œë ˆì´ ë°œìƒ
- ê° Cellë§ˆë‹¤ AVPlayer ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒìƒí•˜ê³ , cellì´ configureë ë•Œ ë¯¸ë¦¬ ì¬ìƒí•˜ë„ë¡ ì„¤ì •í•´ì„œ ë”œë ˆì´ ì¤„ì„
- observeValue()ë¥¼ í†µí•´ í”Œë ˆì´ì–´ì˜ ìƒíƒœë¥¼ ì˜µì €ë¹™í•˜ê³ , ë¡œë”©ì¤€ë¹„ ì™„ë£Œì‹œì— ë¡œë”© ì¸ë””ì¼€ì´í„° í•´ì œ
<br>

### SwiftConcurrency
- ìµœì‹  APIì¸ MusicKitì˜ ë¹„ë™ê¸° ë°©ì‹
- RxSwiftì™€ SwiftConcurrencyë¥¼ ì—°ë™í•˜ê¸° ìœ„í•´ 
<br>

### ModernCollectionView
- ì¶”ì²œí™”ë©´ì˜ ë‹¤ì±„ë¡œìš´ Layoutì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ UICollectionViewCompositionalLayoutí™œìš©
- MusicVideo í™”ë©´ë„ Cellì´ í™”ë©´ì„ ê°€ë“ ì±„ìš°ê³ , í˜ì´ì§•ì„ í•˜ê¸° ìœ„í•´ UICollectionViewCompositionalLayout í™œìš©
- List í™”ë©´ì—ì„œë„ Item ë¡œë“œì‹œ ì• ë‹ˆë©”ì´ì…˜ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ UICollectionViewCompositionalLayoutì˜ List í™œìš©
- ë‹¤ì–‘í•œ ë ˆì´ì•„ì›ƒê³¼ ì• ë‹ˆë©”ì´ì…˜ êµ¬í˜„
<br>

### Realm
- Repository íŒ¨í„´ ì‚¬ìš©
- Repository Protocolì„ í™œìš©í•´ ì¼ê´€ì„±ìˆëŠ” Repository êµ¬ì¡° êµ¬í˜„
- ì—…ë°ì´íŠ¸ ë‚´ì—­ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜í•˜ê¸° ìœ„í•´ notificationToken ì‚¬ìš© 
- TaskìŠ¤ë ˆë“œ ë‚´ì—ì„œ ìŠ¤ë ˆë“œ ë¬¸ì œ ë°œìƒ. ë©”ì¸ìŠ¤ë ˆë“œ ì„¤ì •ìœ¼ë¡œ ìŠ¤ë ˆë“œ ê°•ì œ ì§€ì •
<br>


## âœ… íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

### MusicVideoíƒ€ì…ì— ì—°ê´€ëœ Songíƒ€ì…ì„ ì œê³µí•´ì£¼ì§€ ì•Šì•„ì„œ ë®¤ì§ë¹„ë””ì˜¤ì˜ ë…¸ë˜ë¥¼ ëª» ì°¾ëŠ” ë¬¸ì œ
<div markdown="1">   
```
ë®¤ì§ë¹„ë””ì˜¤ë¥¼ ë³´ë‹¤ê°€ ì¢‹ì•„í•˜ëŠ” ë…¸ë˜ë¥¼ ëˆ„ë¥´ë©´ í•´ë‹¹ ë®¤ì§ë¹„ë””ì˜¤ì˜ ë…¸ë˜ë¥¼ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ì— ì €ì¥í•´ì•¼í•˜ëŠ”ë°
MusicKitì˜ ìš”ì²­í•¨ìˆ˜ë¡œ MusicVideoíƒ€ì…ì— ì—°ê´€ëœ Songì„ ìš”ì²­í•´ë„ nilë§Œ ë¦¬í„´ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.
ê·¸ë˜ì„œ ë®¤ì§ë¹„ë””ì˜¤ì˜ ì•„í‹°ìŠ¤íŠ¸ì™€ ë…¸ë˜ ì´ë¦„ìœ¼ë¡œ MusicKitì˜ Songì„ ê²€ìƒ‰í•œ ë’¤, ë‘˜ ë‹¤ ì¼ì¹˜í•˜ëŠ” ì´ë¦„ì´ ìˆëŠ” Songì´ ìˆìœ¼ë©´ ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
```

```swift
    //MusicKitì˜ ìš”ì²­ ë°©ì‹ìœ¼ë¡œ MusicVideoíƒ€ì…ì˜ Songì„ ìš”ì²­í•´ë„ nilë§Œ ë¦¬í„´
    func requestSearchMVIDCatalog(id: MusicItemID?) async throws -> Song? {
        guard let id else { return nil }
        let response = try await MusicCatalogResourceRequest<MusicVideo>(matching: \.id, equalTo: id).response()
        guard let item = response.items.first else { return nil }
        let songs = try await item.with(.songs).songs
        let song = songs?.first
        return song
    }
    
    => ë®¤ì§ë¹„ë””ì˜¤ì˜ ì•„í‹°ìŠ¤íŠ¸ì™€ ë…¸ë˜ ì´ë¦„ìœ¼ë¡œ Songì„ ê²€ìƒ‰í•œ ë’¤, ì¼ì¹˜í•˜ëŠ” ì´ë¦„ì´ ìˆëŠ” Songì´ ìˆìœ¼ë©´ ë°˜í™˜
    func MusicVideoToSong(_ item: MusicVideo) async throws -> Song? {
        let song = try await requestMVToSongCatalog(term: "\(item.artistName), \(item.title)")
        return song
    }
    
    func requestMVToSongCatalog(term: String) async throws -> Song? {
        let songs = try await MusicCatalogSearchRequest(term: term, types: [Song.self]).response().songs
        let result = songs.filter { term.contains($0.title) && term.contains($0.artistName) }.first
        return result
    }
```
</div>
<br>

### ì• í”Œë®¤ì§ ê¶Œí•œ ìš”ì²­ -> ì‚¬ìš©ìì˜ êµ¬ë…ê¶Œì¥ê¹Œì§€ì˜ ë¶„ê¸°ì²˜ë¦¬
<div markdown="1">
        
```
ì²˜ìŒ ì•±ì„ ì‹œì‘í•˜ë©´ 
1. ì• í”Œë®¤ì§ ê¶Œí•œ ìš”ì²­ 
    -> ê¶Œí•œ ìŠ¹ì¸ì‹œ -> ì•±ì„ ì‚¬ìš©í•˜ë‹¤ê°€ ë…¸ë˜ ì¬ìƒë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ -> ì• í”Œë®¤ì§ êµ¬ë… í™•ì¸
    -> ê¶Œí•œ ê±°ë¶€ì‹œ -> ì•„ì´í°ì˜ ì•± ê¶Œí•œì„¤ì • í™”ë©´ìœ¼ë¡œ ì´ë™
    
2. ì• í”Œë®¤ì§ êµ¬ë… í™•ì¸ í›„
    -> êµ¬ë…ìë¼ë©´ ë…¸ë˜ ì¬ìƒ. êµ¬ë…ì ì¶”ì²œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
    -> êµ¬ë…ìê°€ ì•„ë‹ˆë¼ë©´ êµ¬ë… ì œì•ˆ í™”ë©´ Present
ì˜ ë¶„ê¸°ì²˜ë¦¬ë¥¼ Coordinatorë¥¼ í†µí•´ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
    
```

```swift
//AppCoordinator
    func requestMusicAuthorization() {
        SKCloudServiceController.requestAuthorization { [weak self] status in
            guard let self else { return }
            switch status {
            case .authorized:
                print("ìŠ¹ì¸ë¨")
                makeTabbar() //íƒ­ë°” ë§Œë“¤ê³ , ì•± ì‹œì‘
                break
            default:
                moveToUserSetting() //ì•„ì´í°ì˜ ì„¸íŒ… ì„¤ì •ìœ¼ë¡œ
                break
            }
        }
    }

    //ì•„ì´í°ì˜ ì„¸íŒ… ì„¤ì •ìœ¼ë¡œ ì´ë™ì„ ìœ ë„í•˜ëŠ” Alert
    func moveToUserSetting() {
        DispatchQueue.main.async { [weak self] in
            guard let self else { return }
            let alert = UIAlertController(title: "Access to Apple Music is required to use the app.",
                                          message: 
                                            "Please allow permission in settings to access the music library.",
                                          preferredStyle: .alert)
            alert.view.tintColor = .label
            
            let primaryButton = UIAlertAction(title: "Go to Settings", style: .default) { _ in
                guard let settingsUrl = URL(string: UIApplication.openSettingsURLString) else {
                    return
                }
                if UIApplication.shared.canOpenURL(settingsUrl) {
                    UIApplication.shared.open(settingsUrl, completionHandler: nil)
                }
            }
            
            alert.addAction(primaryButton)
            navigationController?.present(alert, animated: true)
        }
    }
```

```Swift
//MusicPlayerViewModelì—ì„œ ë…¸ë˜ í´ë¦­ì‹œ
    //StoreKitì„ í™œìš©í•´ êµ¬ë… í™•ì¸ 
    func checkAppleMusicSubscriptionEligibility() {
        let controller = SKCloudServiceController()
        controller.requestCapabilities { [weak self] (capabilities, error) in
            guard let self else { return }
            if let error {
                print(error.localizedDescription)
                return
            }
            
            //êµ¬ë…ìê°€ ì•„ë‹ˆë¼ë©´ ì• í”Œë®¤ì§ ê°€ì… ê¶Œìœ í™”ë©´ present
            if capabilities.contains(.musicCatalogSubscriptionEligible) && !capabilities.contains(.musicCatalogPlayback) {
                coordinator?.presentAppleMusicSubscriptionOffer()
            }
        }
    }
    
    //MusicListCoordinatorì˜ ì• í”Œë®¤ì§ ê°€ì…ê¶Œìœ í™”ë©´
    func presentAppleMusicSubscriptionOffer() {
        var options: [SKCloudServiceSetupOptionsKey: Any] = [.action: SKCloudServiceSetupAction.subscribe]
        options[.messageIdentifier] = SKCloudServiceSetupMessageIdentifier.addMusic
        
        let setupViewController = SKCloudServiceSetupViewController()
        setupViewController.delegate = self
        
        setupViewController.load(options: options) { (result, error) in
            if result {
                DispatchQueue.main.async {  [weak self] in
                    guard let self else { return }
                    navigationController?.present(setupViewController, animated: true)
                }
            } else if let error = error {
                print("Error presenting Apple Music subscription offer: \(error.localizedDescription)")
            }
        }
    }
```
</div>
<br>


### Swift Concurrency, Combineê³¼ RxSwiftë¥¼ í•¨ê»˜ ì—°ë™í•˜ë©° ìŠ¤ë ˆë“œ, ë¹„ë™ê¸° ì‹œì  ë¬¸ì œ
<div markdown="1">
        
```
ì„¤ëª…
```

```swift
ì½”ë“œ
```
</div>
<br>


### ë®¤ì§ë¹„ë””ì˜¤ë¥¼ AVPlayerë¡œ ì¬ìƒì‹œì— cellì„ ë„˜ê¸¸ë•Œë§ˆë‹¤ ë¡œë”©ì´ ë°œìƒí•˜ë˜ ë¬¸ì œ
<div markdown="1">
        
```
ì„¤ëª…
```

```swift
ì½”ë“œ
```
</div>
<br>


### ë®¤ì§ë¹„ë””ì˜¤ ë¡œë”©ì‹œì ì„ íŒŒì•…í•´ ì¸ë””ì¼€ì´í„° í‘œì‹œí•´ì£¼ê¸°
<div markdown="1">
        
```
ì„¤ëª…
```

```swift
ì½”ë“œ
```
</div>
<br>

### realmì— ì¢‹ì•„ìš” ëˆ„ë¥¸ ë°ì´í„°ê°€ ì €ì¥ë˜ê±°ë‚˜ ì‚­ì œë ë•Œ í™”ë©´ì˜ ìƒˆë¡œê³ ì¹¨
<div markdown="1">
        
```
ì„¤ëª…
```

```swift
ì½”ë“œ
```
</div>
<br>

### ì½”ë””ë„¤ì´í„° í•´ì œ ì‹œì  ì¡°ì ˆ 
<div markdown="1">
        
```
ì„¤ëª…
```

```swift
ì½”ë“œ
```
</div>
<br>


## ğŸ’» ì•± ê°œë°œ í™˜ê²½

- ìµœì†Œ ì§€ì› ë²„ì „: iOS 16.4+
- Xcode Version 15.0.0
- iPhone 15 Proì—ì„œ ìµœì í™”ë¨, iPhone SE3ê¹Œì§€ í˜¸í™˜ ê°€ëŠ¥
<br>


## ğŸ§‘ğŸ»â€ğŸ’»íšŒê³ 
ê¸ì •ì ì¸ ì 
- ì§§ì€ ì‹œê°„ ë‚´ì— ê¸°íší•œ ì•±ì„ ë§Œë“¤ì—ˆë‹¤ëŠ” ì 
- MusicKitê³¼ AVFoundation ë“± í‰ì†Œì— ì ‘í•˜ê¸° í˜ë“¤ì—ˆë˜ ê¸°ìˆ ìŠ¤íƒì„ ë„ì „í•˜ê³ , êµ¬í˜„í–ˆë‹¤ëŠ” ì 
- RxSwift, MVVMC ë“±ì„ ì‚¬ìš©í•˜ë©´ì„œ í•´ë‹¹ ê¸°ìˆ ì— ëŒ€í•´ ë” ê³ ë¯¼í•˜ê³ , ì´í•´í•˜ë©° êµ¬í˜„í–ˆë‹¤ëŠ” ì 
- MusicKitì˜ Swift Concurrencyì™€ Combineì„ UIKit, RxSwiftë¡œ êµ¬í˜„í–ˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤.
  
ì•„ì‰¬ìš´ ì 
- ì¤‘ê°„ì— ì•„íŒŒì„œ ì•½ 5ì¼ê°„ ê°œë°œì„ í•˜ì§€ ëª»í–ˆë˜ ì ... ã… ã…  ê±´ê°•ì´ ìµœê³ ì…ë‹ˆë‹¤!!
- ì²˜ìŒì— ê¸°íší–ˆë˜ ë‹¤ì–‘í•œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ ì¶”ê°€ í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.
- ê²€ìƒ‰ì´ í˜„ì¬ ê°œë³„ ê³¡ë§Œ ê²€ìƒ‰ë˜ê³  ì•¨ë²”ì´ë‚˜ ì•„í‹°ìŠ¤íŠ¸ ì „ì²´ê°€ ê²€ìƒ‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ì‚¬ìš©ìì˜ ì·¨í–¥ì„ íŒŒì•…í•˜ê³ , Chartsë¥¼ í†µí•´ ê·¸ë˜í”„ë¡œ í‘œí˜„í•˜ë ¤í–ˆì§€ë§Œ ëœì–´ëƒˆê³ , ì• í”Œë®¤ì§ì˜ ì‚¬ìš©ì ì¶”ì²œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¡œ ëŒ€ì²´í–ˆìŠµë‹ˆë‹¤.
 
