# LilsMusic
`Simple, Beautiful Music App` <br>
`UIKit + MVVM-C + RxSwift + MusicKit + Swift Concurrency`
<br>



## ğŸ”— Links
### [ğŸ“±Â AppStore](https://apps.apple.com/app/lilsmusic/id6480001911)
### [ğŸ§‘ğŸ»â€ğŸ’»Â Blog íšŒê³ ](https://thekoon0456.tistory.com/search/lils)
<br>

## ğŸ“±ìŠ¤í¬ë¦°ìƒ·
|<img src="https://github.com/thekoon0456/LilsMusic/assets/106993057/137d699f-695e-4e8c-9f30-89480a32b375"></img>|<img src="https://github.com/thekoon0456/LilsMusic/assets/106993057/5730a407-8cc6-4f88-a066-296e2cf3fcb3"></img>|<img src="https://github.com/thekoon0456/LilsMusic/assets/106993057/5564fdd2-1aa4-40e7-b213-91b52c561280"></img>|<img src="https://github.com/thekoon0456/LilsMusic/assets/106993057/5fd3b214-5672-47c6-8118-11b7f92a78c9"></img>|<img src="https://github.com/thekoon0456/LilsMusic/assets/106993057/7f31beab-e393-435a-a396-cd27827d6ff4"></img>|

## ğŸ“Œ ì£¼ìš” ê¸°ëŠ¥
- ìµœì‹  ì¸ê¸° ìŒì•…ê³¼ ê°œì¸í™”ëœ ì¶”ì²œ ìŒì•… ì œê³µ
- ê³¡ì— ë”°ë¼ ë°°ê²½ìƒ‰ì´ ë³€ê²½ë˜ëŠ” ì˜ˆìœ ìŒì•… í”Œë ˆì´ì–´
- ìµœì‹  ë®¤ì§ë¹„ë””ì˜¤ë¥¼ ë‘˜ëŸ¬ë³´ë©° ì¢‹ì•„í•˜ëŠ” ë…¸ë˜ë¥¼ ë°”ë¡œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ì— ì €ì¥
- í¸ë¦¬í•œ í”Œë¡œíŒ… ë¯¸ë‹ˆ ë®¤ì§ í”Œë ˆì´ì–´ ì‚¬ìš©
- ë‹¤ì–‘í•œ ì• ë‹ˆë©”ì´ì…˜ê³¼ í–…í‹± ë°˜ì‘
<br>

## ğŸ“±ì‹œì—° ì˜ìƒ
|<img src="https://github.com/thekoon0456/LilsMusic/assets/106993057/cb2ceb18-776c-460c-b5dc-9ea4cbcbe82d"></img>|<img src="https://github.com/thekoon0456/LilsMusic/assets/106993057/967715c2-63cb-4ab7-87c8-d65c09dda3a0"></img>|<img src="https://github.com/thekoon0456/LilsMusic/assets/106993057/5a8338c5-1f49-4f16-b71d-b7bdd1d140ad"></img>|<img src="https://github.com/thekoon0456/LilsMusic/assets/106993057/4c7ff5d9-bb76-48f6-b1df-e1d0d7c56b44"></img>|
|:-:|:-:|:-:|:-:|
|`ìŒì•… í”Œë ˆì´ì–´`|`ë®¤ì§ë¹„ë””ì˜¤`|`ë¯¸ë‹ˆ í”Œë ˆì´ì–´`|`ë¼ì´ë¸ŒëŸ¬ë¦¬`|
|<img src="https://github.com/thekoon0456/LilsMusic/assets/106993057/16848413-a69e-4322-9687-6a06b43c9d7d"></img>|<img src="https://github.com/thekoon0456/LilsMusic/assets/106993057/dd07a402-1764-45e5-bf78-5ef3dee0e1f1"></img>|<img src="https://github.com/thekoon0456/LilsMusic/assets/106993057/41c368bd-4ee6-476e-8ca0-8b5e10a4c10b"></img>|<img src="https://github.com/thekoon0456/LilsMusic/assets/106993057/d1b98bdb-ef1c-4181-ba7c-ebe83df1a042"></img>|
|`í™ˆ í™”ë©´`|`ìŒì•… ê²€ìƒ‰`|`ê¶Œí•œ ì„¤ì •`|`êµ¬ë… ì œì•ˆ`|
<br>

## ğŸ’» ì•± ê°œë°œ í™˜ê²½

- ìµœì†Œ ì§€ì› ë²„ì „: iOS 16.4+
- Xcode Version 15.0.0
- iPhone 15 Proì—ì„œ ìµœì í™”ë¨, iPhone SE3ê¹Œì§€ í˜¸í™˜ ê°€ëŠ¥
<br>

## ğŸ“ í•µì‹¬ í‚¤ì›Œë“œ
![iOS](https://img.shields.io/badge/iOS-000000?style=for-the-badge&logo=ios&logoColor=white)
![UIKit](https://img.shields.io/badge/UIkit-2396F3?style=for-the-badge&logo=UIKit&logoColor=white)
![RxSwift](https://img.shields.io/badge/RxSwift-fa4db3?style=for-the-badge&logo=ReactiveX&logoColor=white)<br>
![MusicKit](https://img.shields.io/badge/MusicKit-FA243C?style=for-the-badge&logo=MusicKit&logoColor=white)
![AVFoundation](https://img.shields.io/badge/AVFoundation-FA243C?style=for-the-badge&logo=AVFoundation&logoColor=white)
![AVKit](https://img.shields.io/badge/AVKit-FA243C?style=for-the-badge&logo=AVKit&logoColor=white)<br>
![SwiftConcurrency](https://img.shields.io/badge/SwiftConcurrency-F54A2A?style=for-the-badge&logo=swift&logoColor=white)
![ModernCollectionView](https://img.shields.io/badge/ModernCollectionView-F54A2A?style=for-the-badge&logo=swift&logoColor=white)<br>
![Realm](https://img.shields.io/badge/realm-39477F?style=for-the-badge&logo=Realm&logoColor=white)
![SnapKit](https://img.shields.io/badge/SnapKit-4285F4?style=for-the-badge&logo=SnapKit&logoColor=white)
<br>

## ğŸ’¡ ê¸°ìˆ  ì†Œê°œ

### MVVM
- ë·°ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë¡œì§ì„ ë·°ì™€ ë¶„ë¦¬í•˜ê³ , Input, Output íŒ¨í„´ì„ í™œìš©í•´ ë°ì´í„°ì˜ íë¦„ì„ ì¼ê´€ì„±ìˆê²Œ êµ¬í˜„
- ViewModel Protocolì„ í™œìš©í•´ êµ¬ì¡°ì ìœ¼ë¡œ ì¼ê´€ëœ ë·°ëª¨ë¸ êµ¬ì„± 
<br>

### Coordinator íŒ¨í„´
- ì‚¬ìš©ì ì¸ì¦, ìŒì•… í”Œë ˆì´ì–´ ì¬ìƒê³¼ ê°™ì€ í™”ë©´ ì „í™˜ ì½”ë“œê°€ ë¹„ëŒ€í•´ì§€ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë·° ì»¨íŠ¸ë¡¤ëŸ¬ì™€ í™”ë©´ ì „í™˜ ë¡œì§ì„ ë¶„ë¦¬
- Coordinator ìƒì„± -> ViewModel ìƒì„± -> ViewController ìƒì„±í•˜ëŠ” íŒ¨í„´ìœ¼ë¡œ ì˜ì¡´ì„± ì£¼ì…
- viewControllerì—ì„œ í™”ë©´ì „í™˜ input -> ViewModelì„ í†µí•´ Coordinatorë¡œ ì „ë‹¬í•˜ì—¬ í™”ë©´ ì „í™˜
<br>

### RxSwift
- ì•± ë‚´ì˜ ë¹„ë™ê¸° ì‹œí€€ìŠ¤ ë° ì´ë²¤íŠ¸ ê¸°ë°˜ì˜ ë°ì´í„° íë¦„ì„ ê´€ë¦¬
- ì‚¬ìš©ìì˜ íƒ­ê³¼ ê°™ì€ Inputì€ Observableë¡œ, UIë°”ì¸ë”©í•˜ëŠ” Ouptupì€ Driverë¥¼ í™œìš©í•˜ì—¬ ì¼ê´€ëœ ë°ì´í„° íë¦„ê³¼ UIë°”ì¸ë”© êµ¬í˜„
<br>

### MusicKit
- Appleì˜ MusicKit í”„ë ˆì„ì›Œí¬ë¥¼ í™œìš©í•´ ìŒì•… í”Œë ˆì´ì–´ êµ¬í˜„
- SwiftUIì˜ í”„ë ˆì„ì›Œí¬ì¸ MusicKitì„ UIKitì— ìµœì í™”í•˜ì—¬ êµ¬í˜„
<br>

### AVFoundation, AVKit
- AVQueuePlayerì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ë§Œ ìƒì„±í•˜ê³  ì¬ìƒí•  Itemì„ ë¯¸ë¦¬ ë°°ì—´ë¡œ ë„£ì–´ë†”ì„œ ì‚¬ìš©í–ˆì§€ë§Œ í™”ë©´ ì´ë™ì‹œì— ë”œë ˆì´ ë°œìƒ
- ê° Cellë§ˆë‹¤ AVPlayer ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒìƒí•˜ê³ , cellì´ configureë ë•Œ ë¯¸ë¦¬ ì¬ìƒí•˜ë„ë¡ ì„¤ì •í•´ì„œ ë”œë ˆì´ ì¤„ì„
- observeValue() í•¨ìˆ˜ë¥¼ í†µí•´ AVPlayerì˜ ìƒíƒœë¥¼ ì˜µì €ë¹™í•˜ê³ , ë¡œë”© ì¤€ë¹„ ì™„ë£Œì‹œì— ë¡œë”© ì¸ë””ì¼€ì´í„° í•´ì œ
<br>

### SwiftConcurrency
- ìµœì‹  APIì¸ MusicKitì˜ async/await í•¨ìˆ˜ í™œìš©
- RxSwiftì™€ SwiftConcurrency, Combineì„ ì—°ë™. ìŠ¤ë ˆë“œ ê´€ë¦¬ ì¼ê´€í™”
<br>

### ModernCollectionView
- ì¶”ì²œí™”ë©´ì˜ ë‹¤ì±„ë¡œìš´ Layoutì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ UICollectionView CompositionalLayoutí™œìš©
- MusicVideoíƒ­ì˜ Cellì´ í™”ë©´ì„ ê°€ë“ ì±„ìš°ê³ , í˜ì´ì§• ìŠ¤í¬ë¡¤ êµ¬í˜„
- List í™”ë©´ì—ì„œ Item ë¡œë“œì‹œ ì• ë‹ˆë©”ì´ì…˜ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ UICollectionView CompositionalLayoutì˜ List í™œìš©
- ë‹¤ì–‘í•œ ë ˆì´ì•„ì›ƒê³¼ ì• ë‹ˆë©”ì´ì…˜ êµ¬í˜„
<br>

### Realm
- Repository íŒ¨í„´ì„ ì‚¬ìš©í•´ ë°ì´í„° ê³„ì¸µ ì¶”ìƒí™”
- Repository Protocolì„ í™œìš©í•´ ì¼ê´€ì„±ìˆëŠ” Repository êµ¬ì¡° êµ¬í˜„
- ì—…ë°ì´íŠ¸ ë‚´ì—­ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜í•˜ê¸° ìœ„í•´ notificationToken ì‚¬ìš© 
- ë°ì´í„° ê´€ë¦¬ë¥¼ ì¼ê´€ì„±ìˆê²Œ ìœ ì§€í•˜ë©°, ë³€ê²½ì‚¬í•­ì´ ë°œìƒí• ë•Œë§ˆë‹¤ UIë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„
<br>

## âœ… íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
### ë®¤ì§ë¹„ë””ì˜¤ë¥¼ AVPlayerë¡œ ì¬ìƒì‹œì— cellì„ ë„˜ê¸¸ë•Œë§ˆë‹¤ UIFreezingì´ ë°œìƒí•˜ëŠ” ë¬¸ì œ
<div markdown="1">
MusicVideo ë¦´ìŠ¤ íƒ­ì—ì„œ Cellì„ ë„˜ê¸¸ë•Œë§ˆë‹¤ MusicVideoì˜ ë¡œë”©ìœ¼ë¡œ ì¸í•´ UIFreezingì´ ë°œìƒí•˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.<br>
ê¸°ì¡´ì—ëŠ” AVQueuePlayerì— ì¬ìƒí•  URLë“¤ì„ Queueì— ë„£ì€ ë’¤ì— cellì„ ë„˜ê¸¸ë•Œë§ˆë‹¤ í•˜ë‚˜í•˜ë‚˜ ìš”ì²­í•´ì„œ ì¬ìƒí–ˆì§€ë§Œ<br>
UIFreezing ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ ì, ê° Cellë§ˆë‹¤ configureì‹œì ì— URLì„ ë„£ê³ , ì¼ì‹œì •ì§€ ì‹œí‚¨ ë’¤<br>
Cellì´ í™”ë©´ì— ë³´ì¼ë•Œ ì¬ìƒí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë”œë ˆì´ë¥¼ ì¤„ì˜€ìŠµë‹ˆë‹¤.<br>

```swift
//ReelsCell
//cellì„ êµ¬ì„±í• ë•Œ AVPlayerì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ Cellë§ˆë‹¤ ê°ê° ìƒì„±í•˜ê³ , URLì„ ë„£ê³  ì¼ì‹œì •ì§€ ìƒíƒœë¡œ ëŒ€ê¸°ì‹œí‚´
    func configureCell(_ data: MusicVideo, status: AVPlayer.TimeControlStatus) {
        //cellì¬ì‚¬ìš©í• ë•Œ bind
        bind()
        mvSubject.onNext(data)
        
        guard let url = data.previewAssets?.first?.hlsURL else { return }
        let asset = AVURLAsset(url: url)
        
        DispatchQueue.main.async { [weak self] in
            guard let self else { return }
            DisplayVideoFromAssets(asset: asset, view: musicVideoView)
            setPlayerStatus(status: status)
        }
        ...
    }

    //ë¡œë”© ì¸ë””ì¼€ì´í„°ì™€ ì¬ìƒ ì™„ë£Œì‹œ ë°˜ë³µí•˜ëŠ” Noficifation ìƒì„±
    func DisplayVideoFromAssets(asset: AVURLAsset, view: UIView) {
        startLoadingIndicator()
        
        let playerItem = AVPlayerItem(asset: asset)
        playerItem.addObserver(self, forKeyPath: "status", options: [.new, .old], context: nil)
        player = AVPlayer(playerItem: playerItem).then {
            $0.isMuted = true
        }
        
        let playerLayer = AVPlayerLayer(player: player)
        ...
        
        NotificationCenter.default.addObserver(forName: .AVPlayerItemDidPlayToEndTime,
                                               object: player?.currentItem,
                                               queue: .main) { [weak self] _ in
            guard let self else { return }
            player?.seek(to: .zero)
            player?.play()
        }
    }

    //AVPlayerì˜ ìƒíƒœë¥¼ ì¶”ì í•˜ê³ , readyToPlayì‹œì ì—ì„œ ë¡œë”©ì¸ë””ì¼€ì´í„° í•´ì œ
    override func observeValue(forKeyPath keyPath: String?, of object: Any?, change: [NSKeyValueChangeKey : Any]?, context: UnsafeMutableRawPointer?) {
        if keyPath == "status" {
            if let playerItem = object as? AVPlayerItem {
                switch playerItem.status {
                case .readyToPlay:
                    stopLoadingIndicator()
                case .failed, .unknown:
                    print("Failed to load the video")
                @unknown default:
                    break
                }
            }
        }
    }
```
</div>
<br>

### Coordinatorë¥¼ í™œìš©í•´ ì• í”Œë®¤ì§ ê¶Œí•œ ìš”ì²­ê³¼ ì‚¬ìš©ìì˜ êµ¬ë… ê¶Œì¥ê¹Œì§€ì˜ íë¦„ ì²˜ë¦¬
<div markdown="1">
ì²˜ìŒ ì•±ì„ ì‹œì‘í•˜ë©´<br>
1. ì• í”Œë®¤ì§ ê¶Œí•œ ìš”ì²­ 
    -> ê¶Œí•œ ìŠ¹ì¸ì‹œ -> ì•±ì„ ì‚¬ìš©í•˜ë‹¤ê°€ ë…¸ë˜ ì¬ìƒë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ -> ì• í”Œë®¤ì§ êµ¬ë… í™•ì¸<br>
    -> ê¶Œí•œ ê±°ë¶€ì‹œ -> ì•„ì´í°ì˜ ì•± ê¶Œí•œì„¤ì • í™”ë©´ìœ¼ë¡œ ì´ë™<br>
<br>
2. ì• í”Œë®¤ì§ êµ¬ë… í™•ì¸ í›„
    -> êµ¬ë…ìë¼ë©´ ë…¸ë˜ ì¬ìƒ. êµ¬ë…ì ì¶”ì²œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°<br>
    -> êµ¬ë…ìê°€ ì•„ë‹ˆë¼ë©´ êµ¬ë… ì œì•ˆ í™”ë©´ Present<br>
ì˜ ë¶„ê¸°ì²˜ë¦¬ë¥¼ Coordinatorë¥¼ í†µí•´ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.<br>
<br>

```swift
//StoreKitì„ í™œìš©í•´ êµ¬ë… ê´€ë¦¬
//SubscriptionManager
    func checkAppleMusicSubscriptionEligibility(completion: @escaping (Bool) -> Void) {
        let controller = SKCloudServiceController()
        
        controller.requestCapabilities { capabilities, error in
            if let error {
                print(error.localizedDescription)
                return
            }
            
            if capabilities.contains(.musicCatalogSubscriptionEligible) && !capabilities.contains(.musicCatalogPlayback) {
                completion(false)
                return
            } else {
                completion(true)
                return
            }
        }
    }

//ì•± ì§„ì…ì‹œ UserDefaultsì— êµ¬ë…ì—¬ë¶€ ì €ì¥
//SceneDelegate
    func sceneWillEnterForeground(_ scene: UIScene) {
        SubscriptionManager.shared.checkAppleMusicSubscriptionEligibility { bool in
            print("ìœ ì € êµ¬ë…\(bool)")
            UserDefaultsManager.shared.userSubscription.isSubscribe = bool
        }
    }

//ë…¸ë˜ ì¬ìƒì‹œ êµ¬ë…ì—¬ë¶€ì— ë”°ë¼ êµ¬ë…ì œì•ˆ í˜¹ì€ ìŒì•… í”Œë ˆì´ì–´ present
//MusicListViewModel
        input.playButtonTapped
            .withUnretained(self)
            .subscribe { owner, _ in
                owner.tapImpact()
                Task {
                    guard let tracks = try await owner.fetchTracks(),
                          let firstItem = tracks.first else { return }
                    await owner.musicPlayer.setTrackQueue(item: tracks, startTrack: firstItem)
                    DispatchQueue.main.async {
                        owner.isUserSubscription
                        ? owner.coordinator?.presentMusicPlayer(track: firstItem)
                        : owner.coordinator?.presentAppleMusicSubscriptionOffer()
                    }
                }
            }.disposed(by: disposeBag)
```
</div>
<br>




### Swift Concurrency, Combineê³¼ RxSwiftë¥¼ í•¨ê»˜ ì—°ë™í•˜ë©° ìŠ¤ë ˆë“œ, ë¹„ë™ê¸° ì‹œì  ë¬¸ì œ
<div markdown="1">
        
```
ì„¤ëª…
```

```swift
ì½”ë“œ
```
</div>
<br>
